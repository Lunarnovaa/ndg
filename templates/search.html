<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>{{title}}</title>
    <link rel="stylesheet" href="assets/style.css" />
    <script defer src="assets/search.js"></script>
  </head>
  <body>
    <div class="container">
      <header>
        <div class="header-content">
          <h1 class="site-title">
            <a href="index.html">NixOS Documentation</a>
          </h1>
          <div class="search-container">
            <input
              type="text"
              id="search-input"
              placeholder="Search documentation..."
            />
            <div id="search-results" class="search-results"></div>
          </div>
        </div>
      </header>

      <div class="layout">
        <nav class="sidebar">
          <div class="navigation">
            <h3>Navigation</h3>
            <ul>
              <li><a href="index.html">Home</a></li>
              <li><a href="options.html">Options</a></li>
              <li><a href="search.html">Search</a></li>
            </ul>
          </div>
        </nav>

        <main class="content">
          <h1>Search Documentation</h1>
          <p>
            Use the search box below to find content throughout the
            documentation.
          </p>

          <div class="search-form">
            <input
              type="text"
              id="full-search"
              placeholder="Enter search terms..."
            />
          </div>

          <div id="search-results-container">
            <h2>Results</h2>
            <div id="full-search-results"></div>
          </div>

          <script>
            document.addEventListener("DOMContentLoaded", function () {
              const searchInput = document.getElementById("full-search");
              const resultsContainer = document.getElementById(
                "full-search-results",
              );

              // Load search data
              fetch("assets/search-data.json")
                .then((response) => response.json())
                .then((data) => {
                  searchInput.addEventListener("input", function () {
                    const searchTerm = this.value.toLowerCase();
                    if (searchTerm.length < 2) {
                      resultsContainer.innerHTML =
                        "<p>Please enter at least 2 characters</p>";
                      return;
                    }

                    const results = data.filter(
                      (doc) =>
                        doc.title.toLowerCase().includes(searchTerm) ||
                        doc.content.toLowerCase().includes(searchTerm),
                    );

                    if (results.length === 0) {
                      resultsContainer.innerHTML = "<p>No results found</p>";
                    } else {
                      resultsContainer.innerHTML = results
                        .slice(0, 20)
                        .map(
                          (doc) => `
                                                <div class="search-result">
                                                    <h3><a href="${doc.path}">${doc.title}</a></h3>
                                                    <p>${doc.content.substring(0, 200)}...</p>
                                                </div>
                                            `,
                        )
                        .join("");
                    }
                  });
                })
                .catch((error) => {
                  console.error("Error loading search data:", error);
                  resultsContainer.innerHTML =
                    "<p>Error loading search data</p>";
                });
            });
          </script>
        </main>
      </div>

      <footer>
        <div class="footer-content">
          <p>Generated with ndg | {{current_date}}</p>
        </div>
      </footer>
    </div>
  </body>
</html>
